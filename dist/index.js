"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var pluginName="WebpackBundlePublicPathPlugin",InsertCode=require("./insertCode"),WebpackBundlePublicPathPlugin=function(){function a(b){_classCallCheck(this,a),this.options=b||{},this.publicPath="_bundlePublicPathPlaceholder",this.asyncPublicPath=this.options.asyncPublicPath?this.options.asyncPublicPath:InsertCode,this.originalPublicPath=""}return _createClass(a,[{key:"apply",value:function apply(a){var b=this;a.hooks.entryOption.tap(pluginName,function(){b.originalPublicPath=a.options.output.publicPath,a.options.output.publicPath=b.publicPath}),a.hooks.afterPlugins.tap(pluginName,function(a){b.afterPlugins(a)}),a.hooks.emit.tapPromise(pluginName,function(c){return b.emitTapPromise(c,a)})}},{key:"afterPlugins",value:function afterPlugins(a){if(!a.options.output)throw new Error("Webpack output undefined!");this.publicPath="\"".concat(a.options.output.publicPath,"\"")}},{key:"emitTapPromise",value:function emitTapPromise(a,b){var c=this,d=this.options.chunkNames?a.chunks.filter(function(a){return c.options.chunkNames.includes(a.name)}):a.chunks;if(!d.length)throw new Error("chunks array for replacing publicPath is empty.");var e=d.map(function(a){return a.files.find(function(a){return a.match(/.*\.js/)})}),f=e.map(function(d){return c.replacePublicPath(d,a,b)});return Promise.all(f).then(function(){return console.log("".concat(pluginName,": publicPath replaced."))})}},{key:"replacePublicPath",value:function replacePublicPath(a,b,c){var d=this;return new Promise(function(e){var f=b.assets[a].source(),g=d.publicPath,h=d.asyncPublicPath;b.assets[a].source=function(){return f.replace(g,h)},d.restOptionPublicPath(c),e()})}},{key:"restOptionPublicPath",value:function restOptionPublicPath(a){a.options.output.publicPath=this.originalPublicPath}}]),a}(),_default=WebpackBundlePublicPathPlugin;exports.default=_default,module.exports=exports.default;